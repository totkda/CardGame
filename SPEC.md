# 無心トランプ – 仕様書

最終更新: 2026-02-12 (JST)


## 1. アプリ概要

**無心トランプ**は、  
トランプゲームに没頭できる Android アプリです。  
搭載ゲームは以下の6種：
- Up & Down（ハイ＆ロー）
- ババ抜き（Old Maid）
- 大富豪（Daifugo）
- ブラックジャック（Blackjack）
- ポーカー（Jacks or Better）


## 2. 画面構成と遷移

ゲーム選択（Menu）  
├─ Up & Down  
├─ ババ抜き  
├─ 大富豪  
├─ ブラックジャック  
└─ ポーカー  
　　↳（ゲーム終了時）リザルト

- **ゲーム選択 → 開始 → ゲーム →（条件達成で）リザルト** の流れに統一。
- UIは **縦長レイアウト**を基本とする。
- タイトル画面には 画像（`index_picture.jpg`）とアプリタイトル「無心トランプ」を表示。


## 3. 共通データモデル

- `enum class Suit { CLUBS, DIAMONDS, HEARTS, SPADES, JOKER }`
- `data class Card(val suit: Suit, val rank: Int)`
  - ランク: `1(A) … 13(K)`, `0=JOKER`

### ● ゲームごとの使用デッキ
- Up & Down: **JOKERなし（52枚）**
- ババ抜き: **JOKERあり（53枚）**
- 大富豪: **JOKERあり（53枚）**
- ブラックジャック: **52枚（JOKERなし）**
- ポーカー: **52枚（JOKERなし）**


## 4. 各ゲーム仕様


### 4.1 Up & Down（ハイ＆ロー）

- **表示**：
  - 左=前のカード（表）
  - 右=新しいカード（裏）
- **操作**：  
  プレイヤーが **Up / Down** を選択 → 右カードが表へ → 判定
- **判定ランク**：  
  **A最強 → 2最弱**（A=14、K=13…2=2）
- **スコア**：  
  初期10点、**正解で×2**、**不正解で0かつ即終了**
- **UI**：  
  カードは赤黒配色、コーナー表記、裏カード → 表カードへのフリップ演出
- **補足**：  
  表示崩れ防止のため **余白・カードサイズの自動調整**を実施済み。


### 4.2 ババ抜き（Old Maid）

- **デッキ**：  
  **53枚（JOKER1枚）**
- **配札**：  
  ラウンドロビン → **初期ペアを自動削除**  
  （同ランク2枚、JOKERはペア不可）
- **ターン進行**：  
  常に **左隣から1枚引く** → 引いた直後にペア自動削除
- **終了条件**：  
  最後の1名（JOKER保持者）が敗者
- **UI**：
  - 上段：各プレイヤーの名前・枚数・手番ハイライト
  - 中段：左隣の **裏カード列（タップで選択）**
  - 下段：自分の手札（表、ペアは自動的に消えるため表示のみ）


### 4.3 大富豪（Daifugo）— 役あり＋革命・縛り・8切り＋JOKERペア

- **デッキ**：  
  **53枚（JOKER1枚）**

### ● カード強さ
- 通常：**JOKER ＞ 2 ＞ A ＞ K ＞ … ＞ 3**
- 革命：大小反転（ただし **JOKERは常に最強**）

### ● 出し方（役）
- **シングル**（1枚）
- **グループ**
  - 同 rank 2〜4 枚
  - JOKER + 1枚で **擬似ペア**を作ることができる
- **階段（Run）**
  - **同一スート・連番 3 枚以上**
  - JOKER不可
  - A-2-3 の循環は不可

### ● 比較ルール
- **役種・枚数が同一**であること
- 階段は **末尾カード**の強さで比較

### ● 特殊ルール
- **革命**：4 枚出し
- **縛り**：同スート 2 回連続で発動（流しで解除）
- **8切り**：8 を含む役 → 場流し + 続行リード
- **場流し**：一巡パス → 直前出し手がリード

### ● UI
- シングル：1 枚大きく表示
- グループ：扇形表示
- 階段：横並び
- 革命：背景色変化
- 縛り：スートチップ表示
- **場表示は FieldArea のみ**（二重描画防止）


### 4.4 ブラックジャック（Blackjack）

- **デッキ**：52枚（JOKERなし）
- **プレイヤー操作**：Hit / Stand
- **Aの扱い**：11 または 1（21 を超えると自動的に 1 へ調整）
- **ディーラー**：  
  **S17（ソフト17でスタンド）**
- **ブラックジャック判定**：  
  最初の 2 枚で 21
- **ベット**：固定10（今後変更可能）
- **精算**：
  - プレイヤーBJ：1.5倍
  - プッシュ：ベット返却
  - バースト / ディーラーバースト
- **UI**：  
  ディーラーの 2 枚目は裏 → Reveal  
  結果は「あなた xx / ディーラー xx」で表示


### 4.5 ポーカー（Jacks or Better）

- **デッキ**：52枚（JOKERなし）
- **進行**：
  1. 5 枚ディール
  2. HOLD（保持）をタップ
  3. 非保持カードのみ引き直し
  4. 役判定 → 配当
- **役一覧**：
  - Royal Flush
  - Straight Flush
  - Four of a Kind
  - Full House
  - Flush
  - Straight
  - Three of a Kind
  - Two Pair
  - **Jacks or Better**（J/Q/K/A のワンペア）
  - No Pair
- **UI**：  
  カード下に「HOLD」表示  
  結果で役名と増減を表示


## 5. 非機能仕様（体験・品質）

- **操作感**：  
  タップ主体、アニメは軽量（フェード・スライド）
- **視認性**：  
  赤黒配色、カード比率と余白は自動調整
- **拡張性**：  
  各ゲームは独立 ViewModel、役判定は関数化
- **セキュリティ**：  
  ローカル実行のため通信なし


## 6. 既知のリスク/制約と対処

- Compose / AGP / Kotlin の整合性が崩れるとビルド不可
  - 推奨：**AGP 8.6.1 + Kotlin 1.9.25 + Compose Compiler 1.5.15**
- アイコン依存：  
  `material-icons-extended` が必要
- アニメ依存：  
  `compose-animation` が必要  
  → **AnimatedContent は @OptIn(ExperimentalAnimationApi::class) 必須**


## 7. テスト方針

### ● ユニットテスト
- デッキ枚数・重複
- Up & Down：ランク比較、スコア ×2 / 0
- ババ抜き：初期ペア削除、左隣ドロー、敗者判定
- 大富豪：役分類（classify）、比較（beats）、8切り
- BJ：Hit/Stand、S17、BJ判定
- ポーカー：保持→引き直し→役判定

### ● UIテスト
- 画面遷移  
  （タイトル → ゲーム → 戻る → タイトル）
- 大富豪：場表示（シングル/グループ/階段）
- ババ抜き：左隣タップ取得

### ● 総合
- 各ゲームを通しでプレイして終了まで動作確認


## 8. 今後の拡張

- 大富豪：階段へのJOKERワイルド、2上がり禁止 ON/OFF
- ブラックジャック：Split、Double、Insurance
- ポーカー：ベット数可変、配当表
- オンライン対戦：シード共有、ログ不可逆化など