# トランプゲーム集（Up & Down／ババ抜き／大富豪）仕様書

最終更新: 2026-01-29 (JST)

## 1. 目的とコンセプト
- Android（Kotlin + Jetpack Compose）でトランプゲーム集を提供する。  
- まずは **Up & Down（ハイ＆ロー）／ババ抜き（Old Maid）／大富豪（Daifugō）** を搭載し、将来的な拡張（スピード、ポーカー等）に備える。

## 2. 対象プラットフォームと技術
- **Android 7.0 (API 24) 以上**  
- **Kotlin + Jetpack Compose + Material3**  
- 単一モジュール構成（将来は :core:game などに分離可能）  
- UIは**縦長**レイアウトを基本とする。

## 3. 画面構成と遷移
ゲーム選択（Menu）
├─ Up & Down
├─ ババ抜き
└─ 大富豪
↳（ゲーム終了時）リザルト
- **ゲーム選択 → 開始 → ゲーム →（条件達成で）リザルト** の流れに統一。

## 4. 共通データモデル
- `enum class Suit { CLUBS, DIAMONDS, HEARTS, SPADES, JOKER }`
- `data class Card(val suit: Suit, val rank: Int)`  
  - ランク: `1(A) … 13(K)`, `0=JOKER`
- ゲームごとに投入するデッキを制御  
  - Up & Down: JOKERなし（52枚） 
  - ババ抜き: JOKERあり（53枚）  
  - 大富豪: JOKERあり（53枚）（今回の仕様）
  
## 5. 各ゲーム仕様

### 5.1 Up & Down（ハイ＆ロー）
- **表示**：左=前のカード（表）、右=新しいカード（**裏**）  
- **操作**：プレイヤーが **Up/Down** を選択 → 右カードが**表**にめくれて判定  
- **判定ランク**：**A最強 → 2最弱**（比較は A=14、K=13…3=3、2=2 として実装）  
- **スコア**：初期10点、**正解で×2**、**不正解で0かつ即終了**  
- **UI**：カードは赤黒配色・コーナー表記、フリップ演出あり  
- **補足**：カード表示の**重なり回避**（余白・フォント自動調整）を実施済み。

### 5.2 ババ抜き（Old Maid）
- **人数**：2〜4人（デフォルトは 3 人）  
- **デッキ**：**JOKER 1 枚**を含む 53 枚  
- **配札**：ラウンドロビン配布 → **初期ペアを自動捨て**（同ランク2枚、**JOKERはペア不可**）  
- **ターン**：常に**左隣から1枚引く** → 直後にペア自動捨て  
- **終了**：残り1名で敗者（JOKER保持者）確定、着順を表示  
- **UI**：  
  - 上段=各プレイヤーの枚数・手番ハイライト  
  - 中段=左隣の**裏カード列**（自分の番は**タップ**で選択）  
  - 下段=自分の手札（表、ペアは自動削除のため表示のみ）
  
### 5.3 大富豪（Daifugō）— 役あり＋革命・縛り・8切り＋JOKERペア
- **デッキ**：**53 枚（JOKER 1 枚）**  
- **強さ（通常時）**：**JOKER ＞ 2 ＞ A ＞ K ＞ … ＞ 3**  
  - 革命時は**大小反転**（ただし **JOKER は常に最強**）。  
- **出し方（役）**：
  - **シングル**（1枚）  
  - **グループ**（同ランクの **ペア／スリー／フォー**、JOKERは**ワイルドとしてペア形成のみ**可）  
  - **階段（Run）**：**同一スートで連番3枚以上**（JOKER不可、A-2-3 の循環なし）  
- **比較ルール**：
  - **役種・枚数が同一**であることが前提  
  - 階段は**末尾カード**の強さで比較  
- **革命**：同ランク**4枚出し（フォー）**で即時発生／解除（トグル）  
- **縛り（スート縛り）**：**同スートが2回連続**したら発動、以後そのスート以外は出せない（**流しで解除**）  
- **8切り**：出した役に**8が含まれれば即流し**、出した人が**続行リード**  
- **場流し**：直近出し手以外が**一巡パス** → 直近出し手が**リード**で再開  
- **UI（場の表示）**：
  - シングルは**大きめ1枚**、グループは**扇形**、階段は**横並び**  
  - **革命中は背景色**変更、縛りは**チップ表示**、更新時は**フェード演出**  
  - “二重表示”にならないよう、**場表示は `FieldArea` のみ**を描画（旧テキストカードは削除）
  
## 6. 非機能仕様（体験・品質）
- **操作感**：ワンタップ中心／アニメは軽量（フェード・フリップ）  
- **視認性**：赤黒配色、カード比率、フォント/余白の自動調整で衝突回避  
- **拡張性**：役判定・比較・ルールON/OFFをユーティリティ関数に分離し、段階導入可能  
- **セキュリティ**：ローカル動作（現状オンライン通信なし）。将来オンライン化時は**CSPRNG**・**コミット&リビール**方式等でチート耐性を設計（設計メモ参照）。

## 7. 既知のリスク/制約と対処
- Compose/AGP/Kotlin のバージョン整合が崩れるとビルド不可  
  - 例：**AGP 8.6.1 + Kotlin 1.9.25 + Compose Compiler 1.5.15** の整合で安定  
  - **material-icons-extended**（戻るアイコン）・**compose-animation**（AnimatedContent）など依存を忘れない  
- **Experimental API**（AnimatedContent）は opt-in 必須  
- JOKER導入後は `when (s: Suit)` で **JOKER分岐の網羅性**に注意（`else` or `Suit.JOKER` を明記）  
これらは実装過程で実際に発生・解消済みです。

## 8. テスト方針
- **ユニット**  
  - デッキ重複なし／枚数（52/53）  
  - Up & Down：**A最強・2最弱**の比較、**×2／0即終了**のスコア遷移  
  - ババ抜き：初期ペア自動削除（偶数消去／JOKER不消去）、左隣ドロー、終了判定  
  - 大富豪：`classifySelection`（役判定）、`beats`（革命ON/OFF・縛り有無・Run長一致）、`containsEight`（8切り）  
- **UI**  
  - 画面遷移（ゲーム選択 → 各ゲーム → リスタート）  
  - 場表示：Single/Group/Run 表示切替、革命背景・縛りチップ・8切りの即リセット  
- **総合**  
  - Up & Down：数巡プレイ → 失敗時 0 で終了  
  - ババ抜き：配札→プレイ→1人残りで敗者表示  
  - 大富豪：役ありでの上がり順・場流し・革命/縛りの状態遷移
## 9. 今後の拡張
- 大富豪：**階段へのJOKERワイルド**、**設定ON/OFF（2上がり禁止・縛り強度など）**、CPU強化  
- オンライン対戦：**シードの相互検証**、**サーバ主導配布**、**ログの不可逆化** 等（設計メモ参照）
